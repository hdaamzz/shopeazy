<div class="tab-pane fade" id="tab-orders" role="tabpanel"
                                            aria-labelledby="tab-orders-link">
                                            <h5>Orders List</h5>
                                            <table class="table table-cart table-mobile">
                                                <thead>
                                                    <tr>
                                                        <th>Order Id</th>
                                                        <th>Price</th>
                                                        <th>Address Name</th>
                                                        <th>Status</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>





                                                <tbody>
                                                    <% orderData.forEach((item, index)=> { %>
                                                        <tr>
                                                            <td class="product-col">
                                                                <div class="product">
                                                                    <h3 class="product-title">
                                                                        <span style="color: #495057;">Orderd date :<%=
                                                                                item.created_at.toLocaleDateString() %>
                                                                                </span><br>
                                                                        <a href="#" data-bs-toggle="modal"
                                                                            data-bs-target="#orderModal<%= item._id %>">#
                                                                            <%= item?.order_id %></a>

                                                                    </h3>

                                                                </div>
                                                            </td>
                                                            <td class="price-col">₹<%= item.total_amount %>
                                                            </td>
                                                            <td class="product-title">
                                                                To: <%= item.address_id.name %>
                                                            </td>
                                                            <td class="total-col">
                                                                <%= item.order_status %>
                                                            </td>
                                                            <td class="view-col">
                                                                <% if(item.order_status === 'Cancelled' || item.order_status === 'Return Requested' || item.order_status === 'Returned' ) { %>
                                                                   
                                                                <% } else if(item.order_status === 'Delivered') { %>
                                                                    <button class="btn btn-danger" data-bs-toggle="modal"
                                                                            data-bs-target="#returnOrderModal<%= item._id %>">RETURN ORDER</button>
                                                                <% } else { %>
                                                                    <button class="btn btn-danger" data-bs-toggle="modal"
                                                                            data-bs-target="#cancelOrderModal<%= item._id %>">CANCEL ORDER</button>
                                                                <% } %>
                                                            </td>
                                                        </tr>
                                                        <% }) %>
                                                </tbody>
                                            </table>
                                            <a href="/shop" class="btn btn-outline-primary-2"><span>GO
                                                    SHOP</span><i class="icon-long-arrow-right"></i></a>
                                        </div>






 <% orderData.forEach((item, index)=> { %>
                                            <div class="modal fade" id="orderModal<%= item._id %>" tabindex="-1"
                                                aria-labelledby="orderModalLabel<%= item._id %>" aria-hidden="true">
                                                <div class="modal-dialog modal-xl">
                                                    <!-- Changed to modal-xl for extra large width -->
                                                    <div class="modal-content pr-2 pl-4">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="orderModalLabel<%= item._id %>">
                                                                Order Details</h5>
                                                            <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <h6>Order Information</h6>
                                                                    <p><strong>Order ID:</strong> <span>
                                                                            <%= item?.order_id %>
                                                                        </span></p>
                                                                    <p><strong>Order Date:</strong> <span>
                                                                            <%= item.created_at.toLocaleDateString() %>
                                                                        </span></p>
                                                                    <p><strong>Total Amount:</strong> <span>₹<%=
                                                                                item.total_amount %></span></p>
                                                                    <p><strong>Order Status:</strong> <span>
                                                                            <%= item.order_status %>
                                                                        </span></p>
                                                                    <p><strong>Payment Type:</strong> <span>
                                                                            <%= item.payment_type.pay_type %>
                                                                        </span></p>
                                                                    <p><strong>Payment Status:</strong> <span>
                                                                            <%= item.payment_status %>
                                                                        </span></p>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <h6>Shipping Address</h6>
                                                                    <p>
                                                                        <%= item.address_id.name %>
                                                                    </p>
                                                                    <p>
                                                                        <%= item.address_id.address %>
                                                                    </p>
                                                                    <p>
                                                                        <%= item.address_id.town_city %>, <%=
                                                                                item.address_id.state %>
                                                                                <%= item.address_id.pin_code %>
                                                                    </p>
                                                                    <p>
                                                                        <%= item.address_id.phone_number %>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="row mt-4">
                                                                <div class="col-12">
                                                                    <h6>Order Items</h6>
                                                                    <table class="table">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Product</th>
                                                                                <th>Quantity </th>
                                                                                <th> Price</th>
                                                                                <th>Total</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <% item.items.forEach(product=> { %>
                                                                                <tr class="text-align: center">
                                                                                    <td>
                                                                                        <%= product.name %>
                                                                                    </td>
                                                                                    <td>
                                                                                        <%= product.quantity %>
                                                                                    </td>
                                                                                    <td>₹<%= product.price %>
                                                                                    </td>
                                                                                    <td>₹<%= product.total %>
                                                                                    </td>
                                                                                </tr>
                                                                                <% }) %>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Close</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% }) %>





                                            <% orderData.forEach((item, index)=> { %>
                                                    <!-- Cancel Order Modal -->
                                                    <div class="modal fade" id="cancelOrderModal<%= item._id %>"
                                                        tabindex="-1"
                                                        aria-labelledby="cancelOrderModalLabel<%= item._id %>"
                                                        aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content pr-5 pl-5">
                                                                <div class="modal-header">
                                                                    <h6 class="modal-title"
                                                                        id="cancelOrderModalLabel<%= item._id %>">Cancel
                                                                        Order</h6>
                                                                    <button type="button" class="btn-close"
                                                                        data-bs-dismiss="modal"
                                                                        aria-label="Close"></button>
                                                                </div>
                                                                <form id="cancelOrderForm<%= item._id %>"
                                                                    data-cancel-id="<%= item._id %>"
                                                                    class="cancel-order-form">

                                                                    <div class="modal-body">
                                                                        <div class="mb-3 form-group">
                                                                            <label for="cancelReason<%= item._id %>"
                                                                                class="form-label errMsg">Reason for
                                                                                Cancellation</label>
                                                                            <textarea class="form-control"
                                                                                id="cancelReason<%= item._id %>"
                                                                                rows="3" ></textarea>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary"
                                                                            data-bs-dismiss="modal">Close</button>
                                                                        <button type="submit"
                                                                            class="btn btn-danger">Cancel Order</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>


                                              
                                                    <% }) %>






                                                    <% orderData.forEach((item, index) => { %>
                                                        <div class="modal fade" id="returnOrderModal<%= item._id %>" tabindex="-1" aria-labelledby="returnOrderModalLabel<%= item._id %>" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title" id="returnOrderModalLabel<%= item._id %>">Return Order</h5>
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body pr-3 pl-4">
                                                                        <form id="returnOrderForm<%= item._id %>">
                                                                            <div class="mb-3">
                                                                                <label for="return_reason_<%= item._id %>" class="form-label">Return Reason</label>
                                                                                <textarea class="form-control" id="return_reason_<%= item._id %>" name="return_reason" required></textarea>
                                                                            </div>
                                                                            <input type="hidden" name="order_id" value="<%= item._id %>">
                                                                        </form>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="button" class="btn btn-primary" onclick="submitReturnRequest('<%= item._id %>')">Submit Return Request</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    <% }) %>


 <!-- <td>
                                                            <div
                                                                class="d-flex justify-content-start align-items-center customer-country">
                                                                <div>

                                                                    <% if(orders[i].order_status !== 'Cancelled' ) {%>
                                                                        <% if(orders[i].order_status !== 'Delivered'){%>
                                                                            <% if(orders[i].order_status !== 'Returned'){%>
                                                                    <span>
                                                                        <button id="cancel-order" class="btn btn-danger cancel-order" data-bs-toggle="modal"
                                                                        data-order-id="<%= orders[i]._id %>">CANCEL
                                                                    </button> </span><%}%><%}%><%}%>

                                                                </div>
                                                            </div>
                                                        </td> -->








                                                        <div class="login-page bg-image pt-8 pb-8 pt-md-12 pb-md-12 pt-lg-17 pb-lg-17" style="background-image: url('assets/images/backgrounds/login-bg.jpg')">
            	<div class="container">
            		<div class="form-box">
            			<div class="form-tab">
	            			<ul class="nav nav-pills nav-fill" role="tablist">
							    <li class="nav-item">
							        <a class="nav-link active" id="signin-tab-2" data-toggle="tab" href="#signin-2" role="tab" aria-controls="signin-2" aria-selected="true">Sign In</a>
							    </li>
							    <li class="nav-item">
							        <a class="nav-link" id="register-tab-2" data-toggle="tab" href="#register-2" role="tab" aria-controls="register-2" aria-selected="false">Register</a>
							    </li>
							</ul>
							<div class="tab-content">
							    <div class="tab-pane fade active show" id="signin-2" role="tabpanel" aria-labelledby="signin-tab-2">
							    	<form action="#">
							    		<div class="form-group">
							    			<label for="singin-email-2">Username or email address *</label>
							    			<input type="text" class="form-control" id="singin-email-2" name="singin-email" required="">
							    		</div><!-- End .form-group -->

							    		<div class="form-group">
							    			<label for="singin-password-2">Password *</label>
							    			<input type="password" class="form-control" id="singin-password-2" name="singin-password" required="">
							    		</div><!-- End .form-group -->

							    		<div class="form-footer">
							    			<button type="submit" class="btn btn-outline-primary-2">
			                					<span>LOG IN</span>
			            						<i class="icon-long-arrow-right"></i>
			                				</button>

			                				<div class="custom-control custom-checkbox">
												<input type="checkbox" class="custom-control-input" id="signin-remember-2">
												<label class="custom-control-label" for="signin-remember-2">Remember Me</label>
											</div><!-- End .custom-checkbox -->

											<a href="#" class="forgot-link">Forgot Your Password?</a>
							    		</div><!-- End .form-footer -->
							    	</form>
							    	<div class="form-choice">
								    	<p class="text-center">or sign in with</p>
								    	<div class="row">
								    		<div class="col-sm-6">
								    			<a href="#" class="btn btn-login btn-g">
								    				<i class="icon-google"></i>
								    				Login With Google
								    			</a>
								    		</div><!-- End .col-6 -->
								    		<div class="col-sm-6">
								    			<a href="#" class="btn btn-login btn-f">
								    				<i class="icon-facebook-f"></i>
								    				Login With Facebook
								    			</a>
								    		</div><!-- End .col-6 -->
								    	</div><!-- End .row -->
							    	</div><!-- End .form-choice -->
							    </div><!-- .End .tab-pane -->
							    <div class="tab-pane fade" id="register-2" role="tabpanel" aria-labelledby="register-tab-2">
							    	<form action="#">
							    		<div class="form-group">
							    			<label for="register-email-2">Your email address *</label>
							    			<input type="email" class="form-control" id="register-email-2" name="register-email" required="">
							    		</div><!-- End .form-group -->

							    		<div class="form-group">
							    			<label for="register-password-2">Password *</label>
							    			<input type="password" class="form-control" id="register-password-2" name="register-password" required="">
							    		</div><!-- End .form-group -->

							    		<div class="form-footer">
							    			<button type="submit" class="btn btn-outline-primary-2">
			                					<span>SIGN UP</span>
			            						<i class="icon-long-arrow-right"></i>
			                				</button>

			                				<div class="custom-control custom-checkbox">
												<input type="checkbox" class="custom-control-input" id="register-policy-2" required="">
												<label class="custom-control-label" for="register-policy-2">I agree to the <a href="#">privacy policy</a> *</label>
											</div><!-- End .custom-checkbox -->
							    		</div><!-- End .form-footer -->
							    	</form>
							    	<div class="form-choice">
								    	<p class="text-center">or sign in with</p>
								    	<div class="row">
								    		<div class="col-sm-6">
								    			<a href="#" class="btn btn-login btn-g">
								    				<i class="icon-google"></i>
								    				Login With Google
								    			</a>
								    		</div><!-- End .col-6 -->
								    		<div class="col-sm-6">
								    			<a href="#" class="btn btn-login  btn-f">
								    				<i class="icon-facebook-f"></i>
								    				Login With Facebook
								    			</a>
								    		</div><!-- End .col-6 -->
								    	</div><!-- End .row -->
							    	</div><!-- End .form-choice -->
							    </div><!-- .End .tab-pane -->
							</div><!-- End .tab-content -->
						</div><!-- End .form-tab -->
            		</div><!-- End .form-box -->
            	</div><!-- End .container -->
            </div>



const loadSales = async (req, res) => {
    try {
        // ... (existing code for date filtering)

        const orders = await Order.find(query);

        // Aggregate data for the chart
        const chartData = await Order.aggregate([
            { $match: query },
            { $group: {
                _id: { $dateToString: { format: "%Y-%m-%d", date: "$created_at" } },
                totalSales: { $sum: "$total_amount" }
            }},
            { $sort: { _id: 1 } }
        ]);

        res.render('salesreport', { orders, chartData });
    } catch (error) {
        console.error('Error in loadSales:', error.message);
        res.status(500).send('An error occurred while loading sales data');
    }
};






            const getTopLists = async (req, res) => {
    try {
        const { startDate, endDate } = req.query;
        let dateFilter = {};

        if (startDate && endDate) {
            dateFilter = {
                created_at: {
                    $gte: new Date(startDate),
                    $lte: new Date(endDate)
                }
            };
        }

        // Top 10 Products
        const topProducts = await Order.aggregate([
            { $match: dateFilter },
            { $unwind: "$items" },
            { $group: {
                _id: "$items.product_id",
                totalQuantity: { $sum: "$items.quantity" },
                totalRevenue: { $sum: { $multiply: ["$items.price", "$items.quantity"] } }
            }},
            { $sort: { totalQuantity: -1 } },
            { $limit: 10 },
            { $lookup: {
                from: "products",
                localField: "_id",
                foreignField: "_id",
                as: "productDetails"
            }},
            { $unwind: "$productDetails" },
            { $project: {
                name: "$productDetails.product_name",
                totalQuantity: 1,
                totalRevenue: 1
            }}
        ]);

        // Top 10 Categories
        const topCategories = await Order.aggregate([
            { $match: dateFilter },
            { $unwind: "$items" },
            { $lookup: {
                from: "products",
                localField: "items.product_id",
                foreignField: "_id",
                as: "product"
            }},
            { $unwind: "$product" },
            { $group: {
                _id: "$product.category",
                totalQuantity: { $sum: "$items.quantity" },
                totalRevenue: { $sum: { $multiply: ["$items.price", "$items.quantity"] } }
            }},
            { $sort: { totalQuantity: -1 } },
            { $limit: 10 },
            { $lookup: {
                from: "categories",
                localField: "_id",
                foreignField: "_id",
                as: "categoryDetails"
            }},
            { $unwind: "$categoryDetails" },
            { $project: {
                name: "$categoryDetails.name",
                totalQuantity: 1,
                totalRevenue: 1
            }}
        ]);

        // Top 10 Brands
        const topBrands = await Order.aggregate([
            { $match: dateFilter },
            { $unwind: "$items" },
            { $lookup: {
                from: "products",
                localField: "items.product_id",
                foreignField: "_id",
                as: "product"
            }},
            { $unwind: "$product" },
            { $group: {
                _id: "$product.brand",
                totalQuantity: { $sum: "$items.quantity" },
                totalRevenue: { $sum: { $multiply: ["$items.price", "$items.quantity"] } }
            }},
            { $sort: { totalQuantity: -1 } },
            { $limit: 10 }
        ]);

        res.json({ topProducts, topCategories, topBrands });
    } catch (error) {
        console.error('Error in getTopLists:', error.message);
        res.status(500).json({ error: 'An error occurred while fetching top lists' });
    }
};

module.exports = {
    loadSales,
    downloadPDF,
    downloadExcel,
    getTopLists
};


<h1>Admin Dashboard</h1>

<div>
    <h2>Sales Chart</h2>
    <select id="chartFilter">
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
        <option value="yearly">Yearly</option>
    </select>
    <canvas id="salesChart"></canvas>
</div>

<div>
    <h2>Top 10 Products</h2>
    <ul id="topProducts"></ul>
</div>

<div>
    <h2>Top 10 Categories</h2>
    <ul id="topCategories"></ul>
</div>

<div>
    <h2>Top 10 Brands</h2>
    <ul id="topBrands"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // JavaScript to handle chart rendering and fetching top lists
    // You'll need to implement this part to update the chart and lists dynamically
</script>


 // const orderStatusCounts = await Orders.aggregate([
        //     { $unwind: "$items" },
        //     {
        //         $group: {
        //             _id: "$items.status",
        //             count: { $sum: 1 }
        //         }
        //     }
        // ]);

        // // Process the aggregation results
        // const processedData = {
        //     delivered: 0,
        //     canceled: 0,
        //     returned: 0
        // };

        // orderStatusCounts.forEach(status => {
        //     if (status._id === 'Delivered') {
        //         processedData.delivered = status.count;
        //     } else if (status._id === 'Cancelled') {
        //         processedData.canceled = status.count;
        //     } else if (status._id === 'Returned') {
        //         processedData.returned = status.count;
        //     }
        // });







                         <aside class="sidebar-shop sidebar-filter">
                            <div class="sidebar-filter-wrapper">
                                <div class="widget widget-clean">
                                    <label></label>
                                    <a href="#" class="sidebar-filter-clear">Clean All</a>
                                </div>
                        
                                <div class="widget widget-collapsible">
                                    <h3 class="widget-title">
                                        <a data-toggle="collapse" href="#widget-2" role="button" aria-expanded="true" aria-controls="widget-2">
                                            Filters
                                        </a>
                                    </h3>
                        
                                    <div class="collapse show" id="widget-2">
                                        <div class="widget-body">
                                            <div class="filter-items">
                                                <form action="/shop" id="advanced-search-form" method="GET">
                                                    <div class="widget widget-collapsible">
                                                        <h3 class="widget-title">
                                                            <a data-toggle="collapse" href="#widget-category" role="button" aria-expanded="true" aria-controls="widget-category">
                                                                Category
                                                            </a>
                                                        </h3>
                                                        <div class="collapse show" id="widget-category">
                                                            <div class="widget-body">
                                                                <div class="filter-items">
                                                                    <% categories.forEach(category => { %>
                                                                        <div class="filter-item">
                                                                            <div class="custom-control custom-checkbox">
                                                                                <input type="checkbox" class="custom-control-input" id="category-<%= category._id %>" name="category" value="<%= category._id %>">
                                                                                <label class="custom-control-label" for="category-<%= category._id %>"><%= category.category_name %></label>
                                                                            </div>
                                                                        </div>
                                                                    <% }); %>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="widget widget-collapsible">
                                                        <h3 class="widget-title">
                                                            <a data-toggle="collapse" href="#widget-4" role="button" aria-expanded="true" aria-controls="widget-4">
                                                                Name
                                                            </a>
                                                        </h3>
                                                        <div class="collapse show" id="widget-4">
                                                            <div class="widget-body">
                                                                <div class="filter-items">
                                                                    <div class="filter-item">
                                                                        <div class="custom-control custom-radio">
                                                                            <input type="radio" class="custom-control-input" id="name_asc" name="sort" value="name_asc">
                                                                            <label class="custom-control-label" for="name_asc">A - Z</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="filter-item">
                                                                        <div class="custom-control custom-radio">
                                                                            <input type="radio" class="custom-control-input" id="name_desc" name="sort" value="name_desc">
                                                                            <label class="custom-control-label" for="name_desc">Z - A</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="widget widget-collapsible">
                                                        <h3 class="widget-title">
                                                            <a data-toggle="collapse" href="#widget-3" role="button" aria-expanded="true" aria-controls="widget-3">
                                                                Price
                                                            </a>
                                                        </h3>
                                                        <div class="collapse show" id="widget-3">
                                                            <div class="widget-body">
                                                                <div class="filter-items">
                                                                    <div class="filter-item">
                                                                        <div class="custom-control custom-radio">
                                                                            <input type="radio" class="custom-control-input" id="price_asc" name="sort" value="price_asc">
                                                                            <label class="custom-control-label" for="price_asc">Low - High</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="filter-item">
                                                                        <div class="custom-control custom-radio">
                                                                            <input type="radio" class="custom-control-input" id="price_desc" name="sort" value="price_desc">
                                                                            <label class="custom-control-label" for="price_desc">High - Low</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                        
                                                    <div class="load-more-container text-center">
                                                        <button type="submit" class="btn btn-outline-darker btn-load-more">Apply <i class="icon-refresh"></i></button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </aside>