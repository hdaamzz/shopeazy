<%- include('../layouts/header.ejs') %>

    <body>
        <div class="page-wrapper">
            <header class="header">
                <div class="header-top">
                    <div class="container mb-2 pt-2 pb-2">
                        <div class="header-left">
                        </div><!-- End .header-left -->

                        <div class="header-right">
                            <ul class="top-menu">
                                <!-- <li>
                                <a href="#">Links</a>
                                <ul>
                                    <li><a href="#signin-modal" data-toggle="modal"><i class="icon-user"></i>Login</a></li>
                                </ul>
                            </li> -->
                            </ul><!-- End .top-menu -->
                        </div><!-- End .header-right -->
                    </div><!-- End .container -->
                </div><!-- End .header-top -->

                <div class="header-middle sticky-header">
                    <div class="container">
                        <div class="header-left">
                            <button class="mobile-menu-toggler">
                                <span class="sr-only">Toggle mobile menu</span>
                                <i class="icon-bars"></i>
                            </button>

                            <a href="/" class="logo">
                                <img src="assets/newimages/logo.png" alt="shopEazy Logo" width="105" height="25">
                            </a>

                            <nav class="main-nav">
                                <ul class="menu sf-arrows">
                                    <li class="megamenu-container active">
                                        <a href="/" class="sf-with-ul">Home</a>


                                    </li>
                                    <li>
                                        <a href="category.html" class="sf-with-ul">Shop</a>

                                        <div class="megamenu megamenu-md">
                                            <div class="row no-gutters">
                                                <div class="col-md-8">
                                                    <div class="menu-col">
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="menu-title">Shop with sidebar</div>
                                                                <!-- End .menu-title -->
                                                                <ul>
                                                                    <li><a href="category-list.html">Shop List</a></li>
                                                                    <li><a href="category-2cols.html">Shop Grid 2
                                                                            Columns</a></li>
                                                                    <li><a href="category.html">Shop Grid 3 Columns</a>
                                                                    </li>
                                                                    <li><a href="category-4cols.html">Shop Grid 4
                                                                            Columns</a></li>
                                                                    <li><a href="category-market.html"><span>Shop
                                                                                Market<span
                                                                                    class="tip tip-new">New</span></span></a>
                                                                    </li>
                                                                </ul>

                                                                <div class="menu-title">Shop no sidebar</div>
                                                                <!-- End .menu-title -->
                                                                <ul>
                                                                    <li><a href="category-boxed.html"><span>Shop Boxed
                                                                                No Sidebar<span
                                                                                    class="tip tip-hot">Hot</span></span></a>
                                                                    </li>
                                                                    <li><a href="category-fullwidth.html">Shop Fullwidth
                                                                            No Sidebar</a></li>
                                                                </ul>
                                                            </div><!-- End .col-md-6 -->

                                                            <div class="col-md-6">
                                                                <div class="menu-title">Product Category</div>
                                                                <!-- End .menu-title -->
                                                                <ul>
                                                                    <li><a href="product-category-boxed.html">Product
                                                                            Category Boxed</a></li>
                                                                    <li><a href="product-category-fullwidth.html"><span>Product
                                                                                Category Fullwidth<span
                                                                                    class="tip tip-new">New</span></span></a>
                                                                    </li>
                                                                </ul>
                                                                <div class="menu-title">Shop Pages</div>
                                                                <!-- End .menu-title -->
                                                                <ul>
                                                                    <li><a href="cart.html">Cart</a></li>
                                                                    <li><a href="checkout.html">Checkout</a></li>
                                                                    <li><a href="wishlist.html">Wishlist</a></li>
                                                                    <li><a href="#">My Account</a></li>
                                                                </ul>
                                                            </div><!-- End .col-md-6 -->
                                                        </div><!-- End .row -->
                                                    </div><!-- End .menu-col -->
                                                </div><!-- End .col-md-8 -->

                                                <div class="col-md-4">
                                                    <div class="banner banner-overlay">
                                                        <a href="category.html" class="banner banner-menu">
                                                            <!-- <img src="assets/images/menu/banner-1.jpg" alt="Banner"> -->

                                                            <div class="banner-content banner-content-top">
                                                                <!-- <div class="banner-title text-white">Last <br>Chance<br><span><strong>Sale</strong></span></div> -->
                                                            </div><!-- End .banner-content -->
                                                        </a>
                                                    </div><!-- End .banner banner-overlay -->
                                                </div><!-- End .col-md-4 -->
                                            </div><!-- End .row -->
                                        </div><!-- End .megamenu megamenu-md -->
                                    </li>
                                </ul><!-- End .menu -->
                            </nav><!-- End .main-nav -->
                        </div><!-- End .header-left -->

                        <div class="header-right">
                            <div class="header-search">
                                <a href="#" class="search-toggle" role="button" title="Search"><i
                                        class="icon-search"></i></a>
                                <form action="#" method="get">
                                    <div class="header-search-wrapper">
                                        <label for="q" class="sr-only">Search</label>
                                        <input type="search" class="form-control" name="q" id="q"
                                            placeholder="Search in..." required>
                                    </div><!-- End .header-search-wrapper -->
                                </form>
                            </div><!-- End .header-search -->

                            <!-- <div class="dropdown cart-dropdown">
                                <a href="/cart" class="">
                                    <div class="icon">
                                        <i class="icon-shopping-cart"></i>
                                    </div>
                                  
                            </div> -->
                        </div><!-- End .header-right -->
                    </div><!-- End .container -->
                </div><!-- End .header-middle -->
            </header><!-- End .header -->

            <main class="main">
                <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
                    <div class="container">
                        <h1 class="page-title">My Account<span></span></h1>
                    </div><!-- End .container -->
                </div><!-- End .page-header -->
                <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
                    <div class="container">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                            <!-- <li class="breadcrumb-item"><a href="#">Shop</a></li> -->
                            <li class="breadcrumb-item active" aria-current="page">My Account</li>
                        </ol>
                    </div><!-- End .container -->
                </nav><!-- End .breadcrumb-nav -->

                <div class="page-content">
                    <div class="dashboard">
                        <div class="container">
                            <div class="row">
                                <aside class="col-md-4 col-lg-3">
                                    <ul class="nav nav-dashboard flex-column mb-3 mb-md-0" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="tab-dashboard-link" data-toggle="tab"
                                                href="#tab-dashboard" role="tab" aria-controls="tab-dashboard"
                                                aria-selected="true">Dashboard</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="tab-orders-link" data-toggle="tab"
                                                href="#tab-orders" role="tab" aria-controls="tab-orders"
                                                aria-selected="false">Orders</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="tab-address-link" data-toggle="tab"
                                                href="#tab-address" role="tab" aria-controls="tab-address"
                                                aria-selected="false">Adresses</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="tab-addaddress-link" data-toggle="tab"
                                                href="#tab-addaddress" role="tab" aria-controls="tab-addaddress"
                                                aria-selected="false">Add New Adresses</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="tab-account-link" data-toggle="tab"
                                                href="#tab-account" role="tab" aria-controls="tab-account"
                                                aria-selected="false">Account Details</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="/logout">Sign Out</a>
                                        </li>
                                    </ul>
                                </aside><!-- End .col-lg-3 -->

                                <div class="col-md-8 col-lg-9">
                                    <div class="tab-content">
                                        <div class="tab-pane fade show active" id="tab-dashboard" role="tabpanel"
                                            aria-labelledby="tab-dashboard-link">
                                            <div class="user-info">
                                                <p><span class="label">Username:</span> <span class="value"
                                                        id="userName">
                                                        <%= userData?.user_name %>
                                                    </span></p>
                                                <p><span class="label">Email:</span> <span class="value" id="userEmail">
                                                        <%= userData?.email_address %>
                                                    </span></p>
                                            </div>
                                            <br>
                                            From your account dashboard you can view your <a href="#tab-orders"
                                                class="tab-trigger-link link-underline">recent orders</a>, manage your
                                            <a href="#tab-address" class="tab-trigger-link">shipping and billing
                                                addresses</a>, and <a href="#tab-account" class="tab-trigger-link">edit
                                                your password and account details</a>.</p>
                                        </div>

                                        <div class="tab-pane fade" id="tab-orders" role="tabpanel"
                                            aria-labelledby="tab-orders-link">
                                            <h5>Orders List</h5>
                                            <table class="table table-cart table-mobile">
                                                <thead>
                                                    <tr>
                                                        <th>Order Id</th>
                                                        <th>Price</th>
                                                        <th>Address Name</th>
                                                        <th>Status</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>





                                                <tbody>
                                                    <% orderData.forEach((item, index)=> { %>
                                                        <tr>
                                                            <td class="product-col">
                                                                <div class="product">
                                                                    <h3 class="product-title">
                                                                        <span style="color: #495057;">Orderd date :<%=
                                                                                item.created_at.toLocaleDateString() %>
                                                                                </span><br>
                                                                        <a href="#" data-bs-toggle="modal"
                                                                            data-bs-target="#orderModal<%= item._id %>">#
                                                                            <%= item?.order_id %></a>

                                                                    </h3>

                                                                </div>
                                                            </td>
                                                            <td class="price-col">₹<%= item.total_amount %>
                                                            </td>
                                                            <td class="product-title">
                                                                To: <%= item.address_id.name %>
                                                            </td>
                                                            <td class="total-col">
                                                                <%= item.order_status %>
                                                            </td>
                                                            <td class="view-col">
                                                                <% if(item.order_status === 'Cancelled' || item.order_status === 'Return Requested' || item.order_status === 'Returned' ) { %>
                                                                   
                                                                <% } else if(item.order_status === 'Delivered') { %>
                                                                    <button class="btn btn-danger" data-bs-toggle="modal"
                                                                            data-bs-target="#returnOrderModal<%= item._id %>">RETURN ORDER</button>
                                                                <% } else { %>
                                                                    <button class="btn btn-danger" data-bs-toggle="modal"
                                                                            data-bs-target="#cancelOrderModal<%= item._id %>">CANCEL ORDER</button>
                                                                <% } %>
                                                            </td>
                                                        </tr>
                                                        <% }) %>
                                                </tbody>
                                            </table>
                                            <a href="/shop" class="btn btn-outline-primary-2"><span>GO
                                                    SHOP</span><i class="icon-long-arrow-right"></i></a>
                                        </div>


                                        <% orderData.forEach((item, index)=> { %>
                                            <div class="modal fade" id="orderModal<%= item._id %>" tabindex="-1"
                                                aria-labelledby="orderModalLabel<%= item._id %>" aria-hidden="true">
                                                <div class="modal-dialog modal-xl">
                                                    <!-- Changed to modal-xl for extra large width -->
                                                    <div class="modal-content pr-2 pl-4">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="orderModalLabel<%= item._id %>">
                                                                Order Details</h5>
                                                            <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <h6>Order Information</h6>
                                                                    <p><strong>Order ID:</strong> <span>
                                                                            <%= item?.order_id %>
                                                                        </span></p>
                                                                    <p><strong>Order Date:</strong> <span>
                                                                            <%= item.created_at.toLocaleDateString() %>
                                                                        </span></p>
                                                                    <p><strong>Total Amount:</strong> <span>₹<%=
                                                                                item.total_amount %></span></p>
                                                                    <p><strong>Order Status:</strong> <span>
                                                                            <%= item.order_status %>
                                                                        </span></p>
                                                                    <p><strong>Payment Type:</strong> <span>
                                                                            <%= item.payment_type.pay_type %>
                                                                        </span></p>
                                                                    <p><strong>Payment Status:</strong> <span>
                                                                            <%= item.payment_status %>
                                                                        </span></p>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <h6>Shipping Address</h6>
                                                                    <p>
                                                                        <%= item.address_id.name %>
                                                                    </p>
                                                                    <p>
                                                                        <%= item.address_id.address %>
                                                                    </p>
                                                                    <p>
                                                                        <%= item.address_id.town_city %>, <%=
                                                                                item.address_id.state %>
                                                                                <%= item.address_id.pin_code %>
                                                                    </p>
                                                                    <p>
                                                                        <%= item.address_id.phone_number %>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="row mt-4">
                                                                <div class="col-12">
                                                                    <h6>Order Items</h6>
                                                                    <table class="table">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Product</th>
                                                                                <th>Quantity </th>
                                                                                <th> Price</th>
                                                                                <th>Total</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <% item.items.forEach(product=> { %>
                                                                                <tr class="text-align: center">
                                                                                    <td>
                                                                                        <%= product.name %>
                                                                                    </td>
                                                                                    <td>
                                                                                        <%= product.quantity %>
                                                                                    </td>
                                                                                    <td>₹<%= product.price %>
                                                                                    </td>
                                                                                    <td>₹<%= product.total %>
                                                                                    </td>
                                                                                </tr>
                                                                                <% }) %>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Close</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% }) %>


                                                <% orderData.forEach((item, index)=> { %>
                                                    <!-- Cancel Order Modal -->
                                                    <div class="modal fade" id="cancelOrderModal<%= item._id %>"
                                                        tabindex="-1"
                                                        aria-labelledby="cancelOrderModalLabel<%= item._id %>"
                                                        aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content pr-5 pl-5">
                                                                <div class="modal-header">
                                                                    <h6 class="modal-title"
                                                                        id="cancelOrderModalLabel<%= item._id %>">Cancel
                                                                        Order</h6>
                                                                    <button type="button" class="btn-close"
                                                                        data-bs-dismiss="modal"
                                                                        aria-label="Close"></button>
                                                                </div>
                                                                <form id="cancelOrderForm<%= item._id %>"
                                                                    data-cancel-id="<%= item._id %>"
                                                                    class="cancel-order-form">

                                                                    <div class="modal-body">
                                                                        <div class="mb-3 form-group">
                                                                            <label for="cancelReason<%= item._id %>"
                                                                                class="form-label errMsg">Reason for
                                                                                Cancellation</label>
                                                                            <textarea class="form-control"
                                                                                id="cancelReason<%= item._id %>"
                                                                                rows="3" ></textarea>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary"
                                                                            data-bs-dismiss="modal">Close</button>
                                                                        <button type="submit"
                                                                            class="btn btn-danger">Cancel Order</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>


                                              
                                                    <% }) %>
                                                    <% orderData.forEach((item, index) => { %>
                                                        <div class="modal fade" id="returnOrderModal<%= item._id %>" tabindex="-1" aria-labelledby="returnOrderModalLabel<%= item._id %>" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title" id="returnOrderModalLabel<%= item._id %>">Return Order</h5>
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body pr-3 pl-4">
                                                                        <form id="returnOrderForm<%= item._id %>">
                                                                            <div class="mb-3">
                                                                                <label for="return_reason_<%= item._id %>" class="form-label">Return Reason</label>
                                                                                <textarea class="form-control" id="return_reason_<%= item._id %>" name="return_reason" required></textarea>
                                                                            </div>
                                                                            <input type="hidden" name="order_id" value="<%= item._id %>">
                                                                        </form>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                                        <button type="button" class="btn btn-primary" onclick="submitReturnRequest('<%= item._id %>')">Submit Return Request</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    <% }) %>


                                                        

                                                        <div class="tab-pane fade" id="tab-address" role="tabpanel"
                                                            aria-labelledby="tab-address-link">
                                                            <p>The following addresses will be used on the checkout page
                                                                by default.</p>
                                                            <div class="row">
                                                                <% if (addressData && addressData.length> 0) { %>
                                                                    <% addressData.forEach(function(address) { %>
                                                                        <div class="col-lg-6">
                                                                            <div class="card card-dashboard">
                                                                                <div class="card-body">
                                                                                    <p>
                                                                                        <b>
                                                                                            <%= address?.name %>
                                                                                        </b><br>
                                                                                        <%= address?.address %><br>
                                                                                            <%= address?.town_city %>
                                                                                                <br>
                                                                                                <%= address?.pin_code %>
                                                                                                    <br>
                                                                                                    <%= address?.landmark
                                                                                                        %> <br>
                                                                                                        <%= address.phone_number
                                                                                                            %><br>
                                                                                                            <%= address.state
                                                                                                                %><br>
                                                                                                                <a href="#"
                                                                                                                    class="btn btn-primary"
                                                                                                                    data-bs-toggle="modal"
                                                                                                                    data-bs-target="#editAddressModal<%= address._id %>">
                                                                                                                    Edit
                                                                                                                    Address<i
                                                                                                                        class="icon-edit"></i>
                                                                                                                </a>
                                                                                                                <button
                                                                                                                    class="btn btn-danger delete-address"
                                                                                                                    data-address-id="<%= address._id %>">
                                                                                                                    Delete
                                                                                                                    Address<i
                                                                                                                        class="icon-trash"></i>
                                                                                                                </button>
                                                                                    </p>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <% }); %>
                                                                            <% } else { %>
                                                                                <p>No addresses found.</p>
                                                                                <% } %>
                                                            </div>
                                                        </div>






                                                        <div class="tab-pane fade" id="tab-addaddress" role="tabpanel"
                                                            aria-labelledby="tab-addaddress-link">

                                                            <form id="addAddressForm">

                                                                <div class="form-group">
                                                                    <label for="name"
                                                                        class="form-label errMsg">Name</label>
                                                                    <input type="text" class="form-control" id="name">
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="phone" class="form-label errMsg">Phone
                                                                        Number</label>
                                                                    <input type="tel" class="form-control" id="phone">
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="address"
                                                                        class="form-label errMsg">Address</label>
                                                                    <textarea class="form-control" id="address"
                                                                        rows="3"></textarea>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="city"
                                                                        class="form-label errMsg">Town/City</label>
                                                                    <input type="text" class="form-control" id="city">
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="pincode"
                                                                        class="form-label errMsg">PinCode</label>
                                                                    <input type="number" class="form-control"
                                                                        id="pincode">
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="landmark"
                                                                        class="form-label errMsg">Landmark <span
                                                                            style="color: #495057;">(optional)</span></label>
                                                                    <input type="text" class="form-control"
                                                                        id="landmark">
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="state"
                                                                        class="form-label errMsg">State</label>
                                                                    <input type="text" class="form-control" id="state">
                                                                </div>
                                                                <input type="hidden" id="hiddenid"
                                                                    value="<%= userData?._id%>">


                                                                <button type="submit"
                                                                    class="btn btn-outline-primary-2">Submit</button>
                                                            </form>

                                                        </div>


                                                        <!-- Address Edit Modal -->

                                                        <% if (addressData && addressData.length> 0) { %>
                                                            <% addressData.forEach(function(address) { %>
                                                                <div class="modal fade"
                                                                    id="editAddressModal<%= address._id %>"
                                                                    tabindex="-1"
                                                                    aria-labelledby="editAddressModalLabel"
                                                                    aria-hidden="true">
                                                                    <div class="modal-dialog modal-dialog-centered">
                                                                        <div class="modal-content">
                                                                            <div class="modal-header">
                                                                                <h5 class="modal-title"
                                                                                    id="editAddressModalLabel">Edit
                                                                                    Address</h5>
                                                                                <button type="button" class="btn-close"
                                                                                    data-bs-dismiss="modal"
                                                                                    aria-label="Close"></button>
                                                                            </div>
                                                                            <div class="modal-body pl-5 pr-5">
                                                                                <form
                                                                                    id="editAddressForm<%= address._id %>"
                                                                                    class="edit-address-form"
                                                                                    data-address-id="<%= address._id %>">
                                                                                    <div class="mb-3 form-group">
                                                                                        <label
                                                                                            for="edit-name-<%= address._id %>"
                                                                                            class="form-label errMsg">Name</label>
                                                                                        <input type="text"
                                                                                            class="form-control"
                                                                                            id="edit-name-<%= address._id %>"
                                                                                            value="<%=address.name%>">
                                                                                    </div>
                                                                                    <div class="mb-3 form-group">
                                                                                        <label
                                                                                            for="edit-phone-<%= address._id %>"
                                                                                            class="form-label errMsg">Phone
                                                                                            Number</label>
                                                                                        <input type="tel"
                                                                                            class="form-control"
                                                                                            id="edit-phone-<%= address._id %>"
                                                                                            value="<%=address.phone_number%>">
                                                                                    </div>
                                                                                    <div class="mb-3 form-group">
                                                                                        <label
                                                                                            for="edit-address-<%= address._id %>"
                                                                                            class="form-label errMsg">Address</label>
                                                                                        <textarea class="form-control"
                                                                                            id="edit-address-<%= address._id %>"
                                                                                            rows="3"><%= address.address %></textarea>

                                                                                    </div>
                                                                                    <div class="mb-3 form-group">
                                                                                        <label
                                                                                            for="edit-city-<%= address._id %>"
                                                                                            class="form-label errMsg">Town/City</label>
                                                                                        <input type="text"
                                                                                            class="form-control"
                                                                                            id="edit-city-<%= address._id %>"
                                                                                            value="<%=address.town_city%>">
                                                                                    </div>
                                                                                    <div class="mb-3 form-group">
                                                                                        <label
                                                                                            for="edit-pincode-<%= address._id %>"
                                                                                            class="form-label errMsg">PinCode</label>
                                                                                        <input type="text"
                                                                                            class="form-control"
                                                                                            id="edit-pincode-<%= address._id %>"
                                                                                            value="<%=address.pin_code%>">
                                                                                    </div>
                                                                                    <div class="mb-3 form-group">
                                                                                        <label
                                                                                            for="edit-landmark-<%= address._id %>"
                                                                                            class="form-label errMsg">Landmark
                                                                                            <span
                                                                                                class="text-muted">(optional)</span></label>
                                                                                        <input type="text"
                                                                                            class="form-control"
                                                                                            id="edit-landmark-<%= address._id %>"
                                                                                            value="<%=address.landmark%>">
                                                                                    </div>
                                                                                    <div class="mb-3 form-group">
                                                                                        <label
                                                                                            for="edit-state-<%= address._id %>"
                                                                                            class="form-label errMsg">State</label>
                                                                                        <input type="text"
                                                                                            class="form-control"
                                                                                            id="edit-state-<%= address._id %>"
                                                                                            value="<%=address.state%>">
                                                                                    </div>
                                                                                    <input type="hidden"
                                                                                        id="edit-hiddenid-<%= address._id %>"
                                                                                        value="<%= address._id%>">
                                                                                    <button type="submit"
                                                                                        class="btn btn-primary">Save
                                                                                        changes</button>
                                                                                </form>
                                                                            </div>
                                                                            <div class="modal-footer">
                                                                                <button type="button"
                                                                                    class="btn btn-secondary"
                                                                                    data-bs-dismiss="modal">Close</button>

                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <% }); %>
                                                                    <% } else { %>
                                                                        <p>No addresses found.</p>
                                                                        <% } %>
                                                                            <div class="tab-pane fade" id="tab-account"
                                                                                role="tabpanel"
                                                                                aria-labelledby="tab-account-link">
                                                                                <form id="updateUserForm" action="#">
                                                                                    <label>Name *</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        id="userName1"
                                                                                        value="<%= userData?.user_name %>"
                                                                                        autocomplete="userName">
                                                                                    <small class="form-text">This will
                                                                                        be how your name
                                                                                        will be displayed in the account
                                                                                        section and in
                                                                                        reviews</small>

                                                                                    <label>Current password (required to
                                                                                        make
                                                                                        changes)</label>
                                                                                    <input type="password"
                                                                                        class="form-control"
                                                                                        id="currentPassword"
                                                                                        autocomplete="currentPassword">

                                                                                    <label>New password (leave blank to
                                                                                        keep current
                                                                                        password)</label>
                                                                                    <input type="password"
                                                                                        class="form-control"
                                                                                        id="newPassword"
                                                                                        autocomplete="new-password">

                                                                                    <label>Confirm new password</label>
                                                                                    <input type="password"
                                                                                        class="form-control mb-2"
                                                                                        id="confirmPassword"
                                                                                        autocomplete="confirmPassword">

                                                                                    <button type="submit"
                                                                                        class="btn btn-outline-primary-2">
                                                                                        <span>SAVE CHANGES</span>
                                                                                        <i
                                                                                            class="icon-long-arrow-right"></i>
                                                                                    </button>
                                                                                </form>
                                                                            </div><!-- .End .tab-pane -->
                                    </div>
                                </div><!-- End .col-lg-9 -->
                            </div><!-- End .row -->
                        </div><!-- End .container -->
                    </div><!-- End .dashboard -->
                </div><!-- End .page-content -->
            </main><!-- End .main -->

            <footer class="footer">
                <div class="footer-middle">
                    <div class="container">
                        <div class="row">
                            <div class="col-sm-6 col-lg-3">
                                <div class="widget widget-about">
                                    <img src="assets/newimages/logo.png" class="footer-logo" alt="Footer Logo"
                                        width="105" height="25">
                                    <p>Praesent dapibus, neque id cursus ucibus, tortor neque egestas augue, eu
                                        vulputate magna eros eu erat. </p>

                                    <div class="social-icons">
                                        <a href="#" class="social-icon" target="_blank" title="Facebook"><i
                                                class="icon-facebook-f"></i></a>
                                        <a href="#" class="social-icon" target="_blank" title="Twitter"><i
                                                class="icon-twitter"></i></a>
                                        <a href="#" class="social-icon" target="_blank" title="Instagram"><i
                                                class="icon-instagram"></i></a>
                                        <a href="#" class="social-icon" target="_blank" title="Youtube"><i
                                                class="icon-youtube"></i></a>
                                        <a href="#" class="social-icon" target="_blank" title="Pinterest"><i
                                                class="icon-pinterest"></i></a>
                                    </div><!-- End .soial-icons -->
                                </div><!-- End .widget about-widget -->
                            </div><!-- End .col-sm-6 col-lg-3 -->

                            <div class="col-sm-6 col-lg-3">
                                <div class="widget">
                                    <h4 class="widget-title">Useful Links</h4><!-- End .widget-title -->

                                    <ul class="widget-list">
                                        <li><a href="about.html">About shopEazy</a></li>
                                        <li><a href="#">How to shop on shopEazy</a></li>
                                        <li><a href="#">FAQ</a></li>
                                        <li><a href="contact.html">Contact us</a></li>
                                        <li><a href="/">Log in</a></li>
                                    </ul><!-- End .widget-list -->
                                </div><!-- End .widget -->
                            </div><!-- End .col-sm-6 col-lg-3 -->

                            <div class="col-sm-6 col-lg-3">
                                <div class="widget">
                                    <h4 class="widget-title">Customer Service</h4><!-- End .widget-title -->

                                    <ul class="widget-list">
                                        <li><a href="#">Payment Methods</a></li>
                                        <li><a href="#">Money-back guarantee!</a></li>
                                        <li><a href="#">Returns</a></li>
                                        <li><a href="#">Shipping</a></li>
                                        <li><a href="#">Terms and conditions</a></li>
                                        <li><a href="#">Privacy Policy</a></li>
                                    </ul><!-- End .widget-list -->
                                </div><!-- End .widget -->
                            </div><!-- End .col-sm-6 col-lg-3 -->

                            <div class="col-sm-6 col-lg-3">
                                <div class="widget">
                                    <h4 class="widget-title">My Account</h4><!-- End .widget-title -->

                                    <ul class="widget-list">
                                        <li><a href="cart.html">View Cart</a></li>
                                        <li><a href="#">My Wishlist</a></li>
                                        <li><a href="#">Track My Order</a></li>
                                        <li><a href="#">Help</a></li>
                                    </ul><!-- End .widget-list -->
                                </div><!-- End .widget -->
                            </div><!-- End .col-sm-6 col-lg-3 -->
                        </div><!-- End .row -->
                    </div><!-- End .container -->
                </div><!-- End .footer-middle -->

                <div class="footer-bottom">
                    <div class="container">
                        <p class="footer-copyright">Copyright © 2019 shopEazy Store. All Rights Reserved.</p>
                        <!-- End .footer-copyright -->
                        <figure class="footer-payments">
                            <img src="assets/images/payments.png" alt="Payment methods" width="272" height="20">
                        </figure><!-- End .footer-payments -->
                    </div><!-- End .container -->
                </div><!-- End .footer-bottom -->
            </footer><!-- End .footer -->
        </div><!-- End .page-wrapper -->
        <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

        <!-- Mobile Menu -->
        <div class="mobile-menu-overlay"></div><!-- End .mobil-menu-overlay -->

        <div class="mobile-menu-container">
            <div class="mobile-menu-wrapper">
                <span class="mobile-menu-close"><i class="icon-close"></i></span>

                <form action="#" method="get" class="mobile-search">
                    <label for="mobile-search" class="sr-only">Search</label>
                    <input type="search" class="form-control" name="mobile-search" id="mobile-search"
                        placeholder="Search in..." required>
                    <button class="btn btn-primary" type="submit"><i class="icon-search"></i></button>
                </form>

                <nav class="mobile-nav">
                    <ul class="mobile-menu">
                        <li class="active">
                            <a href="index.html">Home</a>

                        </li>
                        <li>
                            <a href="category.html">Shop</a>
                            <ul>
                                <li><a href="category-list.html">Shop List</a></li>
                                <li><a href="category-2cols.html">Shop Grid 2 Columns</a></li>
                                <li><a href="category.html">Shop Grid 3 Columns</a></li>
                                <li><a href="category-4cols.html">Shop Grid 4 Columns</a></li>
                                <li><a href="category-boxed.html"><span>Shop Boxed No Sidebar<span
                                                class="tip tip-hot">Hot</span></span></a></li>
                                <li><a href="category-fullwidth.html">Shop Fullwidth No Sidebar</a></li>
                                <li><a href="product-category-boxed.html">Product Category Boxed</a></li>
                                <li><a href="product-category-fullwidth.html"><span>Product Category Fullwidth<span
                                                class="tip tip-new">New</span></span></a></li>
                                <li><a href="cart.html">Cart</a></li>
                                <li><a href="checkout.html">Checkout</a></li>
                                <li><a href="wishlist.html">Wishlist</a></li>

                            </ul>
                        </li>
                        <li>
                            <a href="product.html" class="sf-with-ul">Product</a>
                            <ul>
                                <li><a href="product.html">Default</a></li>
                                <li><a href="product-centered.html">Centered</a></li>
                                <li><a href="product-extended.html"><span>Extended Info<span
                                                class="tip tip-new">New</span></span></a></li>
                                <li><a href="product-gallery.html">Gallery</a></li>
                                <li><a href="product-sticky.html">Sticky Info</a></li>
                                <li><a href="product-sidebar.html">Boxed With Sidebar</a></li>
                                <li><a href="product-fullwidth.html">Full Width</a></li>
                                <li><a href="product-masonry.html">Masonry Sticky Info</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#">Pages</a>
                            <ul>


                                <li><a href="login.html">Login</a></li>
                                <li><a href="faq.html">FAQs</a></li>
                                <li><a href="404.html">Error 404</a></li>
                                <li><a href="coming-soon.html">Coming Soon</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="elements-list.html">Elements</a>
                            <ul>
                                <li><a href="elements-products.html">Products</a></li>
                                <li><a href="elements-typography.html">Typography</a></li>
                                <li><a href="elements-titles.html">Titles</a></li>
                                <li><a href="elements-banners.html">Banners</a></li>
                                <li><a href="elements-product-category.html">Product Category</a></li>
                                <li><a href="elements-video-banners.html">Video Banners</a></li>
                                <li><a href="elements-buttons.html">Buttons</a></li>
                                <li><a href="elements-accordions.html">Accordions</a></li>
                                <li><a href="elements-tabs.html">Tabs</a></li>
                                <li><a href="elements-testimonials.html">Testimonials</a></li>
                                <li><a href="elements-blog-posts.html">Blog Posts</a></li>
                                <li><a href="elements-portfolio.html">Portfolio</a></li>
                                <li><a href="elements-cta.html">Call to Action</a></li>
                                <li><a href="elements-icon-boxes.html">Icon Boxes</a></li>
                            </ul>
                        </li>
                    </ul>
                </nav><!-- End .mobile-nav -->

                <div class="social-icons">
                    <a href="#" class="social-icon" target="_blank" title="Facebook"><i class="icon-facebook-f"></i></a>
                    <a href="#" class="social-icon" target="_blank" title="Twitter"><i class="icon-twitter"></i></a>
                    <a href="#" class="social-icon" target="_blank" title="Instagram"><i class="icon-instagram"></i></a>
                    <a href="#" class="social-icon" target="_blank" title="Youtube"><i class="icon-youtube"></i></a>
                </div><!-- End .social-icons -->
            </div><!-- End .mobile-menu-wrapper -->
        </div><!-- End .mobile-menu-container -->

        <!-- Sign in / Register Modal -->

        <!-- Plugins JS File -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/bootstrap.bundle.min.js"></script>
        <script src="assets/js/jquery.hoverIntent.min.js"></script>
        <script src="assets/js/jquery.waypoints.min.js"></script>
        <script src="assets/js/superfish.min.js"></script>
        <script src="assets/js/owl.carousel.min.js"></script>
        <!-- Main JS File -->
        <script src="assets/js/main.js"></script>


        <script>
            async function submitReturnRequest(orderId) {
                const returnReason = document.getElementById(`return_reason_${orderId}`).value;
                try {
                  await  fetch('/returnOrder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        order_id: orderId,
                        return_reason: returnReason
                    })
                })
                .then(response => response.json())
                .then(data => {
               if (data.success) {
                            Swal.fire({
                                title: 'Success!',
                                text: data.message,
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    location.reload();
                                }
                            });
                        } else {
                            Swal.fire({
                                title: 'Error!',
                                text: data.message,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while submitting the return request');
                    });
                } catch (error) {
                    
                }
               
         }
            document.addEventListener('DOMContentLoaded', function () {
                const addAddressForm = document.getElementById('addAddressForm');
                const name = document.getElementById('name');
                const phone = document.getElementById('phone');
                const address = document.getElementById('address');
                const city = document.getElementById('city');
                const landmark = document.getElementById('landmark');
                const state = document.getElementById('state');
                const pin = document.getElementById('pincode');
                const hiddenId = document.getElementById('hiddenid');


                addAddressForm.addEventListener('submit', function (event) {
                    event.preventDefault();
                    const nameValue = name.value.trim();
                    const phoneValue = phone.value.trim();
                    const addressValue = address.value.trim();
                    const cityValue = city.value.trim();
                    const landmarkValue = landmark.value.trim();
                    const stateValue = state.value.trim();
                    const pinValue = pin.value.trim();
                    const hiddenValue = hiddenId.value.trim();

                    validateAddressForm(nameValue, phoneValue, addressValue, cityValue, landmarkValue, stateValue, pinValue, hiddenValue);

                })

                const setError = (element, message) => {
                    const formGroup1 = element.parentElement;
                    const errorDisplay = formGroup1.querySelector('.errMsg');
                    if (errorDisplay) {
                        errorDisplay.innerText = message;
                        element.classList.add('error');
                        errorDisplay.classList.add('error');
                        element.classList.remove('success');
                        errorDisplay.classList.remove('success');
                    }
                }
                const setSuccess = (element, message) => {
                    const formGroup1 = element.parentElement;
                    const errorDisplay = formGroup1.querySelector('.errMsg');
                    if (errorDisplay) {
                        errorDisplay.innerText = message;
                        element.classList.add('success');
                        errorDisplay.classList.add('success');
                        element.classList.remove('error');
                        errorDisplay.classList.remove('error');
                    }
                }
                const validateAddressForm = async (nameValue, phoneValue, addressValue, cityValue, landmarkValue, stateValue, pinValue, hiddenValue) => {
                    let isValid = true;
                    const nameRegex = /^[a-zA-Z\s]+$/;
                    const phoneRegex = /^\+?(\d{1,4}[\s-\.]?)?(\d{1,3}[\s-\.]?)?(\d{1,4}[\s-\.]?)?(\d{1,9})$/;


                    if (nameValue === '') {
                        isValid = false;
                        setError(name, 'Enter Name ')
                    } else if (nameValue.length < 3) {
                        isValid = false;
                        setError(name, 'Name shoul be more than 2 letter')
                    } else if (!nameRegex.test(nameValue)) {
                        isValid = false;
                        setError(name, 'Name should only contain letters and spaces');
                    } else {
                        setSuccess(name, 'Name')
                    }
                    if (phoneValue === '') {
                        isValid = false;
                        setError(phone, 'Enter Phone Number ')
                    } else if (!phoneRegex.test(phoneValue)) {
                        isValid = false;
                        setError(phone, 'Enter Correct Phone Number ')
                    } else {
                        setSuccess(phone, 'Phone Number')
                    }
                    if (addressValue === '') {
                        isValid = false;
                        setError(address, 'Enter Address ')
                    } else if (addressValue.length < 6) {
                        isValid = false;
                        setError(address, 'Please Provide Detailed Address')
                    } else {
                        setSuccess(address, 'Address')
                    }
                    if (cityValue == '') {
                        isValid = false;
                        setError(city, 'Enter Town/City ')
                    } else if (cityValue.length > 20) {
                        isValid = false;
                        setError(city, 'Enter Correct Town/City ')
                    } else {
                        setSuccess(city, 'Town/City')
                    }
                    if (stateValue === '') {
                        isValid = false;
                        setError(state, 'Enter State')
                    } else {
                        setSuccess(state, 'State')
                    }
                    if (pinValue === '') {
                        isValid = false;
                        setError(pin, 'Enter PinCode')
                    } else if (pinValue.length > 7) {
                        isValid = false;
                        setError(pin, 'Invalid Pin')
                    }
                    else {
                        setSuccess(pin, 'PinCode')
                    }
                    if (!isValid) {
                        return;
                    }

                    try {
                        const response = await fetch('/addAddress', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                name: nameValue,
                                phone: phoneValue,
                                address: addressValue,
                                city: cityValue,
                                landmark: landmarkValue,
                                state: stateValue,
                                pin: pinValue,
                                id: hiddenValue

                            })
                        });
                        const data = await response.json();
                        if (data.success) {
                            Swal.fire({
                                title: 'Success!',
                                text: data.message,
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    window.location.href = data.redirectUrl;
                                }
                            });
                        } else {
                            Swal.fire({
                                title: 'Error!',
                                text: data.message,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });
                        }



                    } catch (error) {
                        console.error('Error during add address:', error);

                    }



                }
            });
        </script>

        <script>

            document.addEventListener('DOMContentLoaded', function () {
                const editAddressForms = document.querySelectorAll('.edit-address-form');

                editAddressForms.forEach(form => {
                    form.addEventListener('submit', function (event) {
                        event.preventDefault();
                        const addressId = this.getAttribute('data-address-id');

                        const edit_name = document.getElementById(`edit-name-${addressId}`);
                        const edit_phone = document.getElementById(`edit-phone-${addressId}`);
                        const edit_address = document.getElementById(`edit-address-${addressId}`);
                        const edit_city = document.getElementById(`edit-city-${addressId}`);
                        const edit_landmark = document.getElementById(`edit-landmark-${addressId}`);
                        const edit_state = document.getElementById(`edit-state-${addressId}`);
                        const edit_pin = document.getElementById(`edit-pincode-${addressId}`);
                        const edit_hidden = document.getElementById(`edit-hiddenid-${addressId}`);



                        edit_validateAddressForm(
                            edit_name, edit_phone, edit_address,
                            edit_city, edit_landmark, edit_state,
                            edit_pin, edit_hidden
                        );
                    });
                });
                const deleteButtons = document.querySelectorAll('.delete-address');
                deleteButtons.forEach(button => {
                    button.addEventListener('click', function (event) {
                        event.preventDefault();
                        const addressId = this.getAttribute('data-address-id');
                        deleteAddress(addressId);
                    });
                });
                const updateUserForm = document.getElementById('updateUserForm');
                updateUserForm.addEventListener('submit', function (e) {
                    e.preventDefault();

                    const userName = document.getElementById('userName1').value.trim();
                    const currentPassword = document.getElementById('currentPassword').value.trim();
                    const newPassword = document.getElementById('newPassword').value.trim();
                    const confirmPassword = document.getElementById('confirmPassword').value.trim();


                    userUpdateValidate(userName, currentPassword, newPassword, confirmPassword);
                });

                
                    const cancelOrderForm = document.querySelectorAll('.cancel-order-form')
                    cancelOrderForm.forEach(form => {
                        form.addEventListener('submit', function (e) {
                            e.preventDefault();
                            const orderId = this.getAttribute('data-cancel-id')
                            console.log(orderId);

                            const reason = document.getElementById(`cancelReason${orderId}`)
                            console.log(reason);

                            cancelFormValidate(reason, orderId)

                        });

                    });

                 

               
                const setError = (element, message) => {
                    const formGroup1 = element.parentElement;
                    const errorDisplay = formGroup1.querySelector('.errMsg');
                    if (errorDisplay) {
                        errorDisplay.innerText = message;
                        element.classList.add('error');
                        errorDisplay.classList.add('error');
                        element.classList.remove('success');
                        errorDisplay.classList.remove('success');
                    }
                }

                const setSuccess = (element, message) => {
                    const formGroup1 = element.parentElement;
                    const errorDisplay = formGroup1.querySelector('.errMsg');
                    if (errorDisplay) {
                        errorDisplay.innerText = message;
                        element.classList.add('success');
                        errorDisplay.classList.add('success');
                        element.classList.remove('error');
                        errorDisplay.classList.remove('error');
                    }
                }



                const edit_validateAddressForm = async (
                    edit_name, edit_phone, edit_address,
                    edit_city, edit_landmark, edit_state,
                    edit_pin, edit_hidden
                ) => {

                    const edit_nameValue = edit_name.value.trim();
                    const edit_phoneValue = edit_phone.value.trim();
                    const edit_addressValue = edit_address.value.trim();
                    const edit_cityValue = edit_city.value.trim();
                    const edit_landmarkValue = edit_landmark.value.trim();
                    const edit_stateValue = edit_state.value.trim();
                    const edit_pinValue = edit_pin.value.trim();
                    const edit_hiddenValue = edit_hidden.value.trim();



                    let isValid = true;
                    const nameRegex = /^[a-zA-Z\s]+$/;
                    const phoneRegex = /^\+?(\d{1,4}[\s-\.]?)?(\d{1,3}[\s-\.]?)?(\d{1,4}[\s-\.]?)?(\d{1,9})$/;

                    if (edit_nameValue === '') {
                        isValid = false;
                        setError(edit_name, 'Enter Name');
                    } else if (edit_nameValue.length < 3) {
                        isValid = false;
                        setError(edit_name, 'Name should be more than 2 letters');
                    } else if (!nameRegex.test(edit_nameValue)) {
                        isValid = false;
                        setError(edit_name, 'Name should only contain letters and spaces');
                    } else {
                        setSuccess(edit_name, 'Name');
                    }

                    if (edit_phoneValue === '') {
                        isValid = false;
                        setError(edit_phone, 'Enter Phone Number');
                    } else if (!phoneRegex.test(edit_phoneValue)) {
                        isValid = false;
                        setError(edit_phone, 'Enter Correct Phone Number');
                    } else {
                        setSuccess(edit_phone, 'Phone Number');
                    }

                    if (edit_addressValue === '') {
                        isValid = false;
                        setError(edit_address, 'Enter Address');
                    } else if (edit_addressValue.length < 6) {
                        isValid = false;
                        setError(edit_address, 'Please Provide a Detailed Address');
                    } else {
                        setSuccess(edit_address, 'Address');
                    }

                    if (edit_cityValue === '') {
                        isValid = false;
                        setError(edit_city, 'Enter Town/City');
                    } else if (edit_cityValue.length > 20) {
                        isValid = false;
                        setError(edit_city, 'Enter Correct Town/City');
                    } else {
                        setSuccess(edit_city, 'Town/City');
                    }

                    if (edit_stateValue === '') {
                        isValid = false;
                        setError(edit_state, 'Enter State');
                    } else {
                        setSuccess(edit_state, 'State');
                    }

                    if (edit_pinValue === '') {
                        isValid = false;
                        setError(edit_pin, 'Enter PinCode');
                    } else if (edit_pinValue.length > 7) {
                        isValid = false;
                        setError(edit_pin, 'Invalid Pin');
                    } else {
                        setSuccess(edit_pin, 'PinCode');
                    }

                    if (!isValid) {
                        return;
                    }


                    try {
                        const response = await fetch('/updateAddress', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                name: edit_nameValue,
                                phone: edit_phoneValue,
                                address: edit_addressValue,
                                city: edit_cityValue,
                                landmark: edit_landmarkValue,
                                state: edit_stateValue,
                                pin: edit_pinValue,
                                id: edit_hiddenValue
                            })
                        });
                        const data = await response.json();
                        if (data.success) {
                            Swal.fire({
                                title: 'Success!',
                                text: data.message,
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    window.location.href = data.redirectUrl;
                                }
                            });
                        } else {
                            Swal.fire({
                                title: 'Error!',
                                text: data.message,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });
                        }
                    } catch (error) {
                        console.error('Error during address update:', error);
                    }
                }
               



                async function cancelFormValidate(reason, orderId) {
                        const reasonValue = reason.value.trim();
                        let isValid = true;

                        if (reasonValue === "") {
                            setError(reason, 'Enter a reason for cancellation')
                            isValid = false;
                        } else if (reasonValue.length < 5) {
                            setError(reason, 'Enter proper reason')
                            isValid = false;
                        } else {
                            setSuccess(reason, "Reason for Cancellation")
                        }

                        if (!isValid) {
                            return
                        }
                    const result = await Swal.fire({
                        title: 'Are you sure?',
                        text: "You won't be able to revert this!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes, cancel it!'
                    });
                    if (result.isConfirmed) {
                        try {
                            const response = await fetch('/cancelOrder', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    _id: orderId,
                                    cancel_reason: reasonValue
                                })
                            });
                            const data = await response.json();
                            if (data.success) {
                                Swal.fire(
                                    'Cancelled!',
                                    'Your Order has been canceled.',
                                    'success'
                                ).then(() => {
                                    location.reload();
                                });
                            } else {
                                Swal.fire(
                                    'Error!',
                                    console.log("poyi vannu"),
                                    data.message,
                                    'error'
                                );
                            }

                        } catch (error) {
                            console.error('Error during cancel order:', error);
                            Swal.fire(
                                'Error!',
                                'An error occurred while cancel the order.',
                                'error'
                            );

                        }
                    }
                }

                async function deleteAddress(addressId) {
                   
                    const result = await Swal.fire({
                        title: 'Are you sure?',
                        text: "You won't be able to revert this!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes, delete it!'
                    });

                    if (result.isConfirmed) {
                        try {
                            const response = await fetch('/deleteAddress', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ id: addressId })
                            });

                            const data = await response.json();

                            if (data.success) {
                                Swal.fire(
                                    'Deleted!',
                                    'Your address has been deleted.',
                                    'success'
                                ).then(() => {
                                   
                                    location.reload();
                                });
                            } else {
                                Swal.fire(
                                    'Error!',
                                    data.message,
                                    'error'
                                );
                            }
                        } catch (error) {
                            console.error('Error during address deletion:', error);
                            Swal.fire(
                                'Error!',
                                'An error occurred while deleting the address.',
                                'error'
                            );
                        }
                    }
                }

                async function userUpdateValidate(userName, currentPassword, newPassword, confirmPassword) {

                    if (!userName || !currentPassword) {
                        Swal.fire('Error', 'Name and current password are required', 'error');
                        return;
                    }

                    if (newPassword && newPassword !== confirmPassword) {
                        Swal.fire('Error', 'New passwords do not match', 'error');
                        return;
                    }

                    try {
                        const response = await fetch('/updateUser', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                userName,
                                currentPassword,
                                newPassword: newPassword || undefined
                            })
                        });

                        const data = await response.json();

                        if (data.success) {
                            Swal.fire('Success', 'User information updated successfully', 'success')
                                .then(() => {
                                    location.reload();
                                });
                        } else {
                            Swal.fire('Error', data.message, 'error');
                        }
                    } catch (error) {
                        console.error('Error updating user information:', error);
                        Swal.fire('Error', 'An error occurred while updating user information', 'error');
                    }
                }
            });
        </script>
       


    </body>

    <%- include('../layouts/footer.ejs') %>